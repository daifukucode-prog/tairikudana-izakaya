# 🐟 大陸棚居酒屋 太平洋本店 — 公式Webサイト

太平洋のど真ん中にある架空の居酒屋「大陸棚居酒屋（たいりくだないざかや）」の公式サイトです。  
**Supabase** をバックエンドに採用し、メニュー・お知らせ・予約をリアルタイムに管理できるフルスタック Web アプリケーションです。

> ⚠️ **これは完全にフィクションです。** 実在のレストラン・団体・地名とは一切関係ありません。

## 🌐 デモサイト

👉 **[https://tairikudana-izakaya.vercel.app](https://tairikudana-izakaya.vercel.app)**

## ✨ サイトの特徴

| 機能            | 説明                                                               |
| --------------- | ------------------------------------------------------------------ |
| 🏠 ホームページ | ヒーローセクション、メニュー一覧、コース紹介、店舗情報、予約導線   |
| 🍽️ メニュー     | Supabase からカテゴリ別に取得・表示。管理画面から即時更新可能      |
| 📅 ネット予約   | 日時・人数・コース・お客様情報を入力し、Supabase に保存            |
| 📰 お知らせ     | キャンペーン情報をリアルタイムに配信（公開/非公開の切替対応）      |
| 🔧 管理画面     | メニュー・お知らせの CRUD 操作が可能な管理ダッシュボード           |
| 📊 統計機能     | PV 数・訪問者数・登録データ数をダッシュボードで可視化              |
| 📱 レスポンシブ | モバイルファースト設計。スマホからの予約も快適                     |
| 🔍 SEO          | 動的 sitemap.xml、Google Search Console 連携、JSON-LD 構造化データ |

## 🛠️ 技術スタック

| カテゴリ         | 技術                                          |
| ---------------- | --------------------------------------------- |
| **Frontend**     | Next.js 15 (App Router) / React / Vanilla CSS |
| **Backend / DB** | Supabase (PostgreSQL)                         |
| **認証**         | Server Actions + JWT + HttpOnly Cookie        |
| **デプロイ**     | Vercel                                        |
| **画像**         | AI 画像生成（全メニュー画像を個別に生成）     |

## 🚀 ローカル環境のセットアップ

```bash
# 1. クローン
git clone https://github.com/daifukucode-prog/tairikudana-izakaya.git
cd tairikudana-izakaya

# 2. 依存関係のインストール
npm install

# 3. 環境変数を設定
cp .env.example .env.local
# .env.local を開いて、各値を自分の環境に合わせて書き換える

# 4. 開発サーバーを起動
npm run dev
```

### 環境変数の一覧

| 変数名                          | 用途                                                   | 必須 |
| ------------------------------- | ------------------------------------------------------ | ---- |
| `NEXT_PUBLIC_SUPABASE_URL`      | Supabase プロジェクトの URL                            | ✅   |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase の Anonymous Key                              | ✅   |
| `ADMIN_USER`                    | 管理画面のユーザー名                                   | ✅   |
| `ADMIN_PASSWORD`                | 管理画面のパスワード                                   | ✅   |
| `AUTH_SECRET`                   | JWT 署名用の秘密鍵（`openssl rand -base64 32` で生成） | ✅   |

> ⚠️ `AUTH_SECRET` を設定しないと、Vercel のサーバーレス環境でリクエストごとに秘密鍵が変わり、ログインセッションが維持できません。必ず固定値を設定してください。

## 🔐 セキュリティ設計

### 実装済みの対策

| 対策                      | 実装箇所     | 説明                                                                                                                      |
| ------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------- |
| **JWT + HttpOnly Cookie** | `actions.js` | サーバーサイドでトークンを発行し、`httpOnly` / `secure` / `sameSite: strict` のCookieで管理。XSS によるトークン窃取を防止 |
| **タイミングセーフ比較**  | `actions.js` | パスワード・トークン署名の比較に `crypto.timingSafeEqual` を使用。タイミング攻撃を防止                                    |
| **ランダム遅延**          | `actions.js` | ログイン試行時に 200〜500ms のランダム遅延。ブルートフォース攻撃の効率を低下                                              |
| **トークン有効期限**      | `actions.js` | JWT に 8 時間の有効期限を設定。期限切れトークンは自動的に無効化                                                           |
| **URL 難読化**            | ルーティング | 管理画面のパスは推測されにくい名前を使用                                                                                  |
| **環境変数管理**          | `.env.local` | 認証情報・API キーはすべて環境変数で管理。コードベースに秘密情報は含まない                                                |
| **検索エンジン除外**      | `robots.txt` | 管理エリアを検索エンジンのクロール対象から除外                                                                            |

### 推奨だが未実装の対策

以下は本番運用時に追加を推奨するセキュリティ対策です。

- **Supabase RLS (Row Level Security)**: テーブルごとに読み書きの権限を制御
- **レート制限**: ログイン試行回数の制限（Vercel の Edge Middleware 等で実装可能）
- **CSRF トークン**: フォーム送信時の CSRF 対策（Next.js Server Actions は同一オリジンチェックを行っている）
- **入力値バリデーション**: サーバーサイドでの入力値検証の強化

> ⚠️ 管理画面へのアクセス方法は、リポジトリオーナーに直接お問い合わせください。

## 📁 プロジェクト構成

```
src/
├── app/
│   ├── actions.js         # Server Actions (JWT認証・ログイン・ログアウト)
│   ├── layout.js          # ルートレイアウト (SEO / JSON-LD / GSC連携)
│   ├── page.js            # ホームページ
│   ├── sitemap.js         # 動的サイトマップ生成
│   └── reserve/
│       └── page.js        # ネット予約ページ (ステップフォーム / DB保存)
├── components/            # UIコンポーネント
│   ├── MenuSection.js     # メニュー表示 (Supabase連携)
│   ├── NewsSection.js     # お知らせ表示 (Supabase連携)
│   └── AnalyticsTracker.js # クライアントサイドのアクセス解析
└── lib/
    └── supabase.js        # Supabaseクライアント設定
public/
├── robots.txt             # 検索エンジン用指示ファイル
└── images/                # AI生成の料理画像
```

## 📸 料理画像について

メニューやヒーローセクションの料理画像は全て **AI 画像生成** によるものです。  
各メニューアイテムに合わせた個別の画像を生成しており、実在の料理写真は使用していません。

## ⚖️ 免責事項

- 本サイトは **プログラミング学習・ポートフォリオ目的** で作成された完全なフィクションです。
- 実在のレストラン、チェーン、団体、地名とは **一切関係ありません**。
- 記載の住所（太平洋 北緯10° 東経170°）は **架空の場所** です。
- 予約フォームは動作しますが、これはシステムのデモ用であり、実際の店舗は存在しません。

## 📄 ライセンス

MIT License
